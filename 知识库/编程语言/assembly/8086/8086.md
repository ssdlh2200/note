# 8086
## 8086芯片图
![[20251103-17-18-09.png]]

## 8086管理内存(寻址)
### 一块1MB大小的RAM（内存）
| Range  | Size       | Usage     |
| ------ | ---------- | --------- |
| 00000H |            | 主存储器地址空间  |
| 9FFFFH | 640 KB RAM |           |
| A0000H |            | 显存地址空间    |
| BFFFFH | 128 KB RAM |           |
| C0000H |            | 各类ROM地址空间 |
| FFFFFH | 256 KB     |           |

为什么大小刚好是1MB呢？是因为：
- 8086CPU的的地址总线表示内存单元
- 8086CPU有20根地址总线，每根线都有0和1两种表示，20根线能组合的总数位为：
    - $2^{20} = 1,048,576 \text{个内存单元}$
- 每个内存单元1字节，因此最大可寻址能力为：  
    - $2^{20} \text{ Bytes} = 1 \text{ MB}$
<div style="background-color: #ffe4e1; padding: 10px; border-left: 4px solid #f1c40f;">
<b>注：现代计算机每个内存单元 = 1 字节（Byte） = 8 位（bits）</b>
</div>

### 解决16位寄存器寻址问题
8086最大的寻址能力是1M，是8086是16位结构的CPU，寄存器处理的最大宽度位16位，此时的寻址能力为：
- $2^{16} \text{ Bytes} = 64 \text{ KB}$
所以8086使用了两个16位的地址段地址，偏移地址使用地址加法器合成了一个20位的物理地址
- $\text{物理地址 = 段地址 × 16 + 偏移地址}$
![[20251103-17-51-07.png]]
```
段地址 = 073F
偏移地址 = 0100
真实地址 = 
        073Fh * 10h = 073F0h
        073F0h + 0100h = 074F0h
```


## 8086寄存器

| 寄存器缩写 | 全称                           | 组成部分    | 类型    |
| ----- | ---------------------------- | ------- | ----- |
| AX    | Accumulator Register（累加器寄存器） | AH / AL | 通用寄存器 |
| BX    | Base Register（基址寄存器）         | BH / BL | 通用寄存器 |
| CX    | Count Register（计数寄存器）        | CH / CL | 通用寄存器 |
| DX    | Data Register（数据寄存器）         | DH / DL | 通用寄存器 |
| CS    | Code Segment（代码段寄存器）         | -       | 段寄存器  |
| DS    | Data Segment（数据段寄存器）         | -       | 段寄存器  |
| SS    | Stack Segment（栈段寄存器）         | -       | 段寄存器  |
| ES    | Extra Segment（附加段寄存器）        | -       | 段寄存器  |
| SP    | Stack Pointer（栈指针寄存器）        | -       | 指针寄存器 |
| BP    | Base Pointer（基址指针寄存器）        | -       | 指针寄存器 |
| SI    | Source Index（源变址寄存器）         | -       | 变址寄存器 |
| DI    | Destination Index（目的变址寄存器）   | -       | 变址寄存器 |
| IP    | Instruction Pointer（指令指针寄存器） | -       | 指令指针  |
| FLAGS | Flag Register（标志寄存器）         | -       | 标志寄存器 |

### 通用寄存器
AX寄存器能够存储2个字节的数据，也就是16比特位，能够存储的最大值就是0xFFFF
```text
AX 寄存器 (16位)
┌─────────────────┬─────────────────┐
│       AH        │       AL        │
│ 0 0 0 0 0 0 0 0 │ 0 0 0 0 0 0 0 0 │
└─────────────────┴─────────────────┘

【例】存储18
┌─────────────────┬─────────────────┐
│       AH        │       AL        │
│ 0 0 0 0 0 0 0 0 │ 0 0 0 1 0 0 1 0 │
└─────────────────┴─────────────────┘
```
8086的寄存器是16位的
下一代的32位，64位的寄存兼容上一个代的示意图如下:
```text
EAX 寄存器 (32位)
┌─────────────────┬─────────────────┐
│                 │       AX        │
│      16bits     │      16bits     │
└─────────────────┴─────────────────┘
RAX 寄存器 (64位)
┌─────────────────┬─────────────────┐
│                 │       EAX       │
│      32bits     │      32bits     │
└─────────────────┴─────────────────┘
```
- 8086的 word size（字长）为16bit
- 80386的 word size 为32bit
- x86-64的 word size 为64bit
### 段寄存器
| 段寄存器               | 用途    | 说明                        |
| ------------------ | ----- | ------------------------- |
| CS (Code Segment)  | 代码段   | 存放程序指令，IP 寄存器配合 CS 定位指令地址 |
| DS (Data Segment)  | 数据段   | 存放程序使用的数据，默认大多数数据操作使用 DS  |
| SS (Stack Segment) | 堆栈段   | 存放堆栈数据，SP/BP 寄存器配合 SS 使用  |
| ES (Extra Segment) | 附加数据段 | 辅助存放数据，常用于字符串和数组操作        |

## 8086栈

8086中栈是一段连续的内存空间，由SP（段寄存器）和IP(栈指针共同管理)





## MS-DOS
### Debug
debug是dos下的调试程序，可以查看CPU寄存器、内存的情况

| 命令    | 功能说明                  | 用途                          |
| ----- | --------------------- | --------------------------- |
| **R** | 查看、修改 **CPU寄存器** 的内容  | 查看或手动更改寄存器状态（如AX、BX、CS、IP等） |
| **D** | 查看**内存**中的内容（以十六进制显示） | 检查指定内存地址中的数据或指令             |
| **E** | 修改**内存**中的内容          | 手动编辑内存数据或指令                 |
| **U** | 将内存中的**机器指令反汇编**为汇编指令 | 分析某段机器码对应的汇编代码              |
| **A** | 以**汇编指令格式写入机器指令**到内存  | 在指定内存地址直接编写汇编指令             |
| **T** | **单步执行**一条机器指令        | 调试程序，逐条执行机器指令并观察结果          |
| **Q** | 退出debug模式             |                             |

-  r命令
![[20251105-15-05-04.png]]
- d命令
    - d 段地址:偏移地址 
    - d 段地址:偏移地址 结束地址的偏移地址（省略结束地址默认显示128个字节）

```
-d 73f:100 f ❌
    起始地址：73fh * 10h + 100h = 74f0h
    结束地址：73fh * 10h + fh = 73ff报错 
    
    
-d 73f:100 107 ✔️
    起始地址：73fh * 10h + 100h = 74f0h
    结束地址：73fh * 10h + 107h = 74f7h
```
![[20251105-15-50-00.png]]
- e命令
![[20251105-15-17-55.png]]
- u命令
![[20251105-15-21-34.png]]
- a命令
    - a命令默认也是往CS:IP处写指令
![[20251105-16-04-20.png]]
- t命令
    - 执行CS:IP处的指令
![[20251105-16-06-01.png]]